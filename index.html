<!doctype html>
<html lang="zh-Hant">
  <head>
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#2563eb" />
    
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="旅之手帖" />
    <link
      rel="apple-touch-icon"
      href="https://cdn-icons-png.flaticon.com/512/826/826070.png"
    />
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Japan Trip 2026</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="./css/style.css" />

    <script src="./js/weather.js"></script>
    <script src="./js/app.js"></script>
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>
  <body x-data="travelApp()" x-init="init()" x-cloak class="bg-gray-100">
    <div
      class="max-w-md mx-auto bg-white min-h-screen shadow-2xl flex flex-col relative overflow-x-hidden"
    >
      <header
        class="bg-white sticky top-0 z-30 shadow-sm border-b border-gray-50 px-6 pt-10 pb-4"
      >
        <div class="flex justify-between items-start">
          <div>
            <h1 class="text-2xl font-black text-gray-900 tracking-tight">
              2月京阪四國之旅
            </h1>
            <div
              @click="updateWeather()"
              class="flex items-center gap-2 mt-1 cursor-pointer group"
            >
              <span
                class="text-sm font-bold text-gray-500 group-active:text-blue-500"
                x-text="currentCity"
              ></span>
            </div>
          </div>
          <button
            @click="showModal = true"
            class="bg-black text-white w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg active:scale-90 transition"
          >
            <i class="fas fa-plus"></i>
          </button>
        </div>

        <div class="flex gap-3 mt-6 overflow-x-auto no-scrollbar pb-2">
          <template x-for="n in 10" :key="n">
            <button
              @click="activeDay = n; updateWeather()"
              :class="activeDay === n ? 'tab-active' : 'bg-gray-50 text-gray-400 border border-transparent'"
              class="px-4 py-2.5 rounded-xl transition-all whitespace-nowrap min-w-[80px] text-center"
            >
              <div
                class="text-[10px] font-black uppercase mb-0.5"
                x-text="'Day' + n"
              ></div>
              <div class="text-xs font-bold" x-text="getDayDate(n)"></div>
            </button>
          </template>
        </div>
      </header>

      <main class="flex-grow px-5 py-6 mb-24">
        <div x-show="currentTab === 'itinerary'" x-transition>
          <template x-for="(item, index) in currentEvents" :key="index">
            <div class="mb-6 flex gap-4">
              <div
                class="text-[11px] font-bold text-gray-400 pt-1 w-10 text-center"
                x-text="item.time"
              ></div>
              <div
                class="flex-grow japanese-card rounded-3xl p-5 relative bg-white border border-gray-50 shadow-sm"
              >
                <span
                  class="absolute top-4 right-5 text-[9px] font-bold text-blue-500 uppercase"
                  x-text="item.category"
                ></span>
                <h3
                  class="font-bold text-gray-900 pr-10"
                  x-text="item.location"
                ></h3>
                <p class="text-xs text-gray-400 mt-2" x-text="item.note"></p>
                <div class="mt-4 flex gap-2">
                  <a
                    :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location)"
                    target="_blank"
                    class="flex-grow bg-gray-900 text-white text-[10px] py-3 rounded-xl text-center font-bold active:bg-blue-600 transition"
                    >導覽</a
                  >
                  <button
                    @click="deleteEvent(index)"
                    class="px-4 bg-gray-50 text-gray-300 rounded-xl hover:text-red-500 transition"
                  >
                    <i class="fas fa-trash-alt text-xs"></i>
                  </button>
                </div>
              </div>
            </div>
          </template>
          <div
            x-show="currentEvents.length === 0"
            class="text-center py-20 text-gray-300 text-sm italic"
          >
            今日無行程安排
          </div>
        </div>

        <div x-show="currentTab === 'weather'" x-transition class="space-y-4">
          <div
            class="bg-gradient-to-br from-blue-600 to-indigo-700 text-white rounded-[2.5rem] p-8 shadow-xl relative overflow-hidden"
          >
            <div class="relative z-10 text-center">
              <i
                :class="weather.icon"
                class="text-6xl text-yellow-300 drop-shadow-md mb-4"
              ></i>
              <h2
                class="text-5xl font-light mb-2"
                x-text="Math.round(weather.temp) + '°'"
              ></h2>
              <p
                class="text-sm opacity-80 mb-4"
                x-text="'體感溫度 ' + Math.round(weather.feelsLike) + '°'"
              ></p>
              <div
                class="inline-block px-4 py-1 bg-white/20 rounded-full backdrop-blur-md text-xs font-bold"
                x-text="weather.desc"
              ></div>

              <div
                class="mt-6 flex justify-center gap-6 text-xs opacity-70 border-t border-white/10 pt-6"
              >
                <span
                  >最高:
                  <strong x-text="Math.round(weather.maxTemp) + '°'"></strong
                ></span>
                <span
                  >最低:
                  <strong x-text="Math.round(weather.minTemp) + '°'"></strong
                ></span>
              </div>
            </div>
            <i
              :class="weather.icon"
              class="absolute -right-8 -bottom-8 text-[15rem] opacity-10"
            ></i>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div
              class="bg-white p-5 rounded-3xl border border-gray-100 flex items-center gap-4 shadow-sm"
            >
              <div
                class="w-10 h-10 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-umbrella"></i>
              </div>
              <div>
                <p class="text-[9px] text-gray-400 font-black uppercase">
                  降雨機率
                </p>
                <p
                  class="text-sm font-black text-gray-800"
                  x-text="weather.rainProb + '%'"
                ></p>
              </div>
            </div>
            <div
              class="bg-white p-5 rounded-3xl border border-gray-100 flex items-center gap-4 shadow-sm"
            >
              <div
                class="w-10 h-10 bg-gray-50 text-gray-500 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-wind"></i>
              </div>
              <div>
                <p class="text-[9px] text-gray-400 font-black uppercase">
                  風速
                </p>
                <p
                  class="text-sm font-black text-gray-800"
                  x-text="weather.wind + ' km/h'"
                ></p>
              </div>
            </div>
            <div
              class="bg-white p-5 rounded-3xl border border-gray-100 flex items-center gap-4 shadow-sm"
            >
              <div
                class="w-10 h-10 bg-orange-50 text-orange-500 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-sun"></i>
              </div>
              <div>
                <p class="text-[9px] text-gray-400 font-black uppercase">
                  日出
                </p>
                <p
                  class="text-sm font-black text-gray-800"
                  x-text="weather.sunrise"
                ></p>
              </div>
            </div>
            <div
              class="bg-white p-5 rounded-3xl border border-gray-100 flex items-center gap-4 shadow-sm"
            >
              <div
                class="w-10 h-10 bg-indigo-50 text-indigo-500 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-moon"></i>
              </div>
              <div>
                <p class="text-[9px] text-gray-400 font-black uppercase">
                  日落
                </p>
                <p
                  class="text-sm font-black text-gray-800"
                  x-text="weather.sunset"
                ></p>
              </div>
            </div>
          </div>
        </div>

        <div x-show="currentTab === 'manage'" x-transition class="space-y-6">
          <div
            class="bg-white rounded-[2rem] p-6 border border-gray-100 shadow-sm text-center"
          >
            <h2 class="text-lg font-black text-gray-900 mb-1">
              資料備份與同步
            </h2>
            <p
              class="text-[10px] text-gray-400 mb-6 uppercase tracking-wider font-bold"
            >
              CSV Management
            </p>

            <div class="space-y-3">
              <button
                @click="exportCSV()"
                class="w-full flex items-center justify-between bg-blue-50 text-blue-600 p-5 rounded-2xl font-bold active:scale-95 transition"
              >
                <div class="flex items-center gap-3">
                  <i class="fas fa-file-export"></i>
                  <span>導出行程 (CSV)</span>
                </div>
                <i class="fas fa-chevron-right text-xs opacity-30"></i>
              </button>

              <div class="relative">
                <input
                  type="file"
                  accept=".csv"
                  @change="importCSV($event)"
                  class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                />
                <div
                  class="flex items-center justify-between bg-gray-50 text-gray-500 p-5 rounded-2xl font-bold border-2 border-dashed border-gray-200"
                >
                  <div class="flex items-center gap-3">
                    <i class="fas fa-file-import"></i>
                    <span>匯入行程 (CSV)</span>
                  </div>
                  <i class="fas fa-plus text-xs opacity-30"></i>
                </div>
              </div>
            </div>
          </div>
      </main>

      <footer
        class="absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-gray-100 pb-10 pt-4 flex justify-around z-30"
      >
        <button
          @click="currentTab = 'itinerary'"
          :class="currentTab === 'itinerary' ? 'text-blue-600' : 'text-gray-300'"
          class="flex flex-col items-center gap-1 transition-colors"
        >
          <i class="fas fa-map-marked-alt text-xl"></i>
          <span class="text-[9px] font-black uppercase">行程</span>
        </button>
        <button
          @click="currentTab = 'weather'"
          :class="currentTab === 'weather' ? 'text-blue-600' : 'text-gray-300'"
          class="flex flex-col items-center gap-1 transition-colors"
        >
          <i class="fas fa-cloud-sun text-xl"></i>
          <span class="text-[9px] font-black uppercase">天氣</span>
        </button>
        <button
          @click="currentTab = 'manage'"
          :class="currentTab === 'manage' ? 'text-blue-600' : 'text-gray-300'"
          class="flex flex-col items-center gap-1"
        >
          <i class="fas fa-cog text-xl"></i
          ><span class="text-[9px] font-black uppercase">管理</span>
        </button>
      </footer>
    </div>

    <div
      class="fixed inset-0 z-50 flex items-end bg-black/40 backdrop-blur-sm"
      x-show="showModal"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-end="opacity-0"
    >
      <div
        class="bg-white w-full max-w-md mx-auto rounded-t-[3rem] p-8 pb-12 shadow-2xl"
        @click.away="showModal = false"
        x-show="showModal"
        x-transition:enter="transition ease-out duration-300 translate-y-full"
        x-transition:enter-end="translate-y-0"
      >
        <div class="w-12 h-1 bg-gray-100 rounded-full mx-auto mb-8"></div>
        <h2 class="text-2xl font-black mb-8">新增計畫</h2>
        <div class="space-y-6">
          <div>
            <label class="text-[10px] font-black text-gray-400 uppercase ml-1"
              >地點名稱</label
            >
            <input
              type="text"
              x-model="form.location"
              placeholder="例如：金閣寺"
              class="w-full text-xl font-bold border-b-2 border-gray-100 py-2 focus:outline-none focus:border-blue-500 transition-colors"
            />
          </div>
          <div>
            <label class="text-[10px] font-black text-gray-400 uppercase ml-1"
              >備註 / 必吃</label
            >
            <input
              type="text"
              x-model="form.note"
              placeholder="例如：抹茶冰淇淋"
              class="w-full text-lg font-medium border-b-2 border-gray-100 py-2 focus:outline-none focus:border-blue-500 transition-colors"
            />
          </div>
          <div class="flex gap-4">
            <div class="flex-1">
              <label class="text-[10px] font-black text-gray-400 uppercase ml-1"
                >時間</label
              >
              <input
                type="time"
                x-model="form.time"
                class="w-full bg-gray-50 p-4 rounded-2xl font-bold mt-1"
              />
            </div>
            <div class="flex-1">
              <label class="text-[10px] font-black text-gray-400 uppercase ml-1"
                >分類</label
              >
              <select
                x-model="form.category"
                class="w-full bg-gray-50 p-4 rounded-2xl font-bold mt-1"
              >
                <option>景點</option>
                <option>美食</option>
                <option>交通</option>
                <option>購物</option>
                <option>住宿</option>
              </select>
            </div>
          </div>
          <button
            @click="saveEvent"
            class="w-full bg-blue-600 text-white py-5 rounded-3xl font-black shadow-xl shadow-blue-200 active:scale-95 transition-all mt-4"
          >
            加入行程
          </button>
        </div>
      </div>
    </div>

    <script>
      // PWA Service Worker 註冊
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("../sw.js", { scope: "/" })
            .then((reg) => console.log("SW Registered"))
            .catch((err) => console.log("SW Registration Failed", err));
        });
      }
    </script>
  </body>
</html>
