<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ—…éŠè¡Œç¨‹ç®¡ç†å™¨ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <style>
      [x-cloak] {
        display: none !important;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <div
      class="max-w-md mx-auto bg-white min-h-screen shadow-lg flex flex-col"
      x-data="itineraryApp()"
      x-init="$watch('schedule', value => localStorage.setItem('travel_data', JSON.stringify(value)))"
      x-cloak
    >
      <header
        class="bg-indigo-600 text-white p-6 sticky top-0 z-20 shadow-md flex justify-between items-center"
      >
        <div>
          <h1 class="text-xl font-bold">æˆ‘çš„æ—…éŠåŠ©æ‰‹</h1>
          <p class="text-indigo-100 text-xs">è³‡æ–™å·²è‡ªå‹•å„²å­˜è‡³ç€è¦½å™¨</p>
        </div>
        <button
          @click="openModal()"
          class="bg-white text-indigo-600 p-2 rounded-full shadow hover:bg-indigo-50 transition"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
        </button>
      </header>

      <nav
        class="flex overflow-x-auto bg-white border-b sticky top-[84px] z-10 scrollbar-hide"
      >
        <template x-for="n in 5" :key="n">
          <button
            @click="activeDay = n"
            :class="activeDay === n ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-400'"
            class="flex-1 min-w-[70px] py-4 text-center border-b-2 font-bold transition-colors"
            x-text="'Day ' + n"
          ></button>
        </template>
      </nav>

      <main class="p-4 flex-grow">
        <template x-if="currentEvents.length === 0">
          <div class="text-center py-20 text-gray-400">
            <p>æœ¬æ—¥å°šç„¡è¡Œç¨‹</p>
            <button @click="openModal()" class="mt-2 text-indigo-500 underline">
              é»æ­¤æ–°å¢
            </button>
          </div>
        </template>

        <template x-for="(item, index) in currentEvents" :key="index">
          <div
            class="mb-4 bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm"
          >
            <div class="p-4">
              <div class="flex justify-between items-start">
                <span
                  class="text-indigo-600 font-mono font-bold"
                  x-text="item.time"
                ></span>
                <div class="flex gap-2">
                  <button
                    @click="editEvent(index)"
                    class="text-gray-400 hover:text-blue-500"
                  >
                    ç·¨è¼¯
                  </button>
                  <button
                    @click="deleteEvent(index)"
                    class="text-gray-400 hover:text-red-500"
                  >
                    åˆªé™¤
                  </button>
                </div>
              </div>
              <h3
                class="text-lg font-bold text-gray-800 mt-1"
                x-text="item.location"
              ></h3>
              <p class="text-gray-500 text-sm mt-1" x-text="item.note"></p>

              <a
                :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location)"
                target="_blank"
                class="mt-3 inline-flex items-center text-xs bg-gray-100 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-200"
              >
                ğŸ“ åœ¨ Google Maps æŸ¥çœ‹
              </a>
            </div>
          </div>
        </template>
      </main>

      <div
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"
        x-show="showModal"
        x-transition
      >
        <div
          class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden"
          @click.away="showModal = false"
        >
          <div class="p-6">
            <h2
              class="text-xl font-bold mb-4"
              x-text="isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹'"
            ></h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >åœ°é»åç¨±</label
                >
                <input
                  type="text"
                  x-model="form.location"
                  class="mt-1 block w-full border border-gray-300 rounded-md p-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                />
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700"
                    >æ™‚é–“</label
                  >
                  <input
                    type="time"
                    x-model="form.time"
                    class="mt-1 block w-full border border-gray-300 rounded-md p-2"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700"
                    >æ—¥æœŸ</label
                  >
                  <select
                    x-model.number="form.day"
                    class="mt-1 block w-full border border-gray-300 rounded-md p-2 text-sm"
                  >
                    <option value="1">Day 1</option>
                    <option value="2">Day 2</option>
                    <option value="3">Day 3</option>
                    <option value="4">Day 4</option>
                    <option value="5">Day 5</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >å‚™è¨» (äº¤é€š/ç¾é£Ÿç­‰)</label
                >
                <textarea
                  x-model="form.note"
                  rows="2"
                  class="mt-1 block w-full border border-gray-300 rounded-md p-2"
                ></textarea>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-6 py-4 flex justify-end gap-3">
            <button
              @click="showModal = false"
              class="text-gray-500 hover:text-gray-700 px-4 py-2"
            >
              å–æ¶ˆ
            </button>
            <button
              @click="saveEvent"
              class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700"
              x-text="isEditing ? 'æ›´æ–°' : 'æ–°å¢'"
            ></button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function itineraryApp() {
        const savedData = localStorage.getItem("travel_data");
        return {
          activeDay: 1,
          showModal: false,
          isEditing: false,
          editIndex: null,
          // è¡¨å–®è³‡æ–™
          form: { day: 1, time: "", location: "", note: "" },
          // è¡Œç¨‹è³‡æ–™ (å˜—è©¦å¾ localStorage è®€å–ï¼Œå¦å‰‡çµ¦åˆå§‹å€¼)
          schedule: savedData
            ? JSON.parse(savedData)
            : [
                {
                  day: 1,
                  time: "10:00",
                  location: "æ±äº¬è»Šç«™",
                  note: "é ˜å– JR Pass",
                },
                { day: 1, time: "12:00", location: "éŠ€åº§", note: "åƒæ‹‰éºµ" },
              ],

          get currentEvents() {
            return this.schedule
              .filter((e) => e.day === this.activeDay)
              .sort((a, b) => a.time.localeCompare(b.time));
          },

          openModal() {
            this.isEditing = false;
            this.form = {
              day: this.activeDay,
              time: "12:00",
              location: "",
              note: "",
            };
            this.showModal = true;
          },

          saveEvent() {
            if (!this.form.location) return alert("è«‹è¼¸å…¥åœ°é»");

            if (this.isEditing) {
              // ç·¨è¼¯é‚è¼¯
              const originalEvent = this.currentEvents[this.editIndex];
              const globalIndex = this.schedule.findIndex(
                (e) => e === originalEvent
              );
              this.schedule[globalIndex] = { ...this.form };
            } else {
              // æ–°å¢é‚è¼¯
              this.schedule.push({ ...this.form });
            }

            this.activeDay = this.form.day;
            this.showModal = false;
          },

          editEvent(index) {
            this.isEditing = true;
            this.editIndex = index;
            const event = this.currentEvents[index];
            this.form = { ...event };
            this.showModal = true;
          },

          deleteEvent(index) {
            if (confirm("ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ")) {
              const eventToDelete = this.currentEvents[index];
              this.schedule = this.schedule.filter((e) => e !== eventToDelete);
            }
          },
        };
      }
    </script>
  </body>
</html>
